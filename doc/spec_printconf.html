<HTML>
<HEAD>
   <TITLE>Printer (auto)configurator</TITLE>
   <STYLE type="text/css">
   BODY { 
     color: black;
     background: white
   }
   </STYLE>
</HEAD>
<BODY>
<TABLE BORDER WIDTH="100%">
  <TR>
    <TD>Document</TD>
    <TD>Printer (auto)configurator</TD>
  </TR>
  <TR>
    <TD>Author</TD>
    <TD>Jan Holesovsky &lt;kendy@suse.cz&gt;</TD>
  </TR>
  <TR>
    <TD>Id</TD>
    <TD>$Id$</TD>
  </TR>
</TABLE>

<H2 align=center>Vision</H2>
<P>Configuration of the printer should be as easy as a children play. This
should be provided by as much autoconfiguration and default values as possible. <br>
<font color="darkblue">
Keep in mind that children games can be rather complicated and also pretty cruel. Have 
you ever thought about slipping wings off your printer?
</font>

<H2 align=center><A NAME="configurator">The Configurator</A></H2>
<P>The main point of this document is <A HREF="#wizard">The Configuration
Wizard</A>. The <B>printer instatallation tool</B> is in fact the poor Wizard,
the <B>administration tool</B> has these additional features:

<UL>
  <LI>Listing of already configured (accessible) printers.
  <LI>Adding a new printer using <A HREF="#wizard">The Configuration
    Wizard</A>.
  <LI>Deleting a printer.
  <LI>Editing the printer configuration.
  <LI>Configuring the filter.
</UL>

<H3><A NAME="delete">Deleting the printer</A></H3>
The Configurator should ask user if he is really sure. After it, it should
remove everything it previously installed.

<H3><A NAME="edit">Editing the printer settings</A></H3>
This is similar to <A HREF="#manual_add">Manual addition of the printer</A>,
step 5. of the Configuration Wizard, but the current settings of the edited
printer are used as the default values.

<H3>Configuring the filter</H3>
Starts the <A HREF="spec_filter.html#filt_setup">Filter Setup</A>.

<H3><A NAME="wizard">The Configuration Wizard</A></H3>
<P><I>If you want to know deeply, how to get particular information for
configuration, have a look at <A HREF="spec_connection.html">Printer connection
document</A>.</I>

<P>When the user starts the Configuration Wizard, the following steps should be
walked through:</P>
<OL>
  <LI><B>Perform autodetection of possible printer connections.</B>
  Check for <TT>lpd</TT>, <TT>apsfilter</TT> and other necessary packages.
  <LI><B>Autoprobe printer models on detected connections.</B>
    <BR><I>Reference: <A HREF="spec_connection.html">Printer connection
      document</A></I>
  <LI><B><A HREF="#add_printer">Add</A> all autoprobed printers sitting on
    autodetected connections</B> to the spooling system.
    <BR><I>The connection (/dev/lp?, network address, etc.), manufacturer and
    type of these printers is known.</I>
  <LI><A HREF="#ask_model">Ask user about the manufacturer and the model</A> of
    <B>all unknown printers sitting on autodetected connections</B> and
    <A HREF="#add_printer">add</A> them to the spooling system.
    <BR><I>The connection is known and it is known that there is a printer on
    it, but its manufacturer and its type is unknown. (E.g. when a queue on a
    remote host is detected --- you know the name of the queue but not the
    printer type. Another example: Autodetected printer is not in the printer
    database.) More printers can use one kind of connection!</I>
  <LI><B><A NAME="manual_add">Manual addition of the printers.</A></B>
    <OL type=i>
      <I>This is necessary for printers or printer connections that cannot
        provide information about themselves, or when some parts of the system
	weren't configured properly.</I>
      <LI>Ask the user about the type of connection (parport, serial, ...,
        remote, ...)
      <LI>Ask the user for all required information about the connection and
        for <A HREF="#ask_model">printer's manufacturer and model</A>.
	Of course, help him as much as possible (e.g. provide list of serial
	devices, list near hosts, ...)
	<BR><I>(Reference: <A HREF="spec_connection.html">Printer connection
	document</A>)</I> 
      <LI>Ask the printer name.
      <LI>Configure the filter. <I>(See <A
      HREF="spec_filter.html#filt_setup">The Filter Setup</A> section.)</I>
      <LI><A HREF="#add_printer">Add</A> the printer to the spooling system.
    </OL>
    <I>Repeat the manual addition until the user answers, that he has no
      other printers to configure.</I>
  <LI>Finish, congratulate, etc. :-)
</OL>

<H2 align=center><A name="ask_model">Asking the user about the printer's
manufacturer and model</A></H2>
<P><I>See the <A HREF="spec_filter.html#database">Printer Database</A>.</I></P>

<P>The Configurator should provide a list of all printers in the printer
database. This list should be structured --- into a tree or into two windows,
where in one, there are vendors and in the other, there are models of the
selected vendor there.</P>
    
<!--P>Also, possibility of choice "Have disk" should be provided. This driver
disk would contain a .rpm with a special ps-&gt;printer convertor and a
small printer database.</P-->

<H2 align=center><A name="add_printer">Adding a printer to the spooling
system</A></H2>

<P>Ask for this (required) information:</P>
<UL>
  <LI><B>Queue name</B>. The Configurator should provide default names for
    printers. The user should be able to specify more names than one. One of
    the printers in the spooling system should be <B><TT>lp</TT></B>,
    the default printer.
  <!--LI><B>Spool directory</B>. The default name should be derived from the name
    of the queue. <I>It is not necessary to ask this in "novice" installation
    method.</I>
  <LI><B>File limit</B>. Ask the user if he wants to set limit, and, if so, how
    much space should be left on the disk when spooling. Default: No limit.
    <I>It is not necessary to ask this in "novice" installation method.</I-->

</UL>

<P><B>At this point, the Configurator knows every required information about
the printer.</B> It means:</P>
<UL>
  <LI>Printer connection and its parameters.
  <LI>Printer's manufacturer and model.
  <LI>Queue name<!--, spool directory and file limit-->.
</UL>

<P>Now it should update the spooling system:

<OL>
  <LI>Write the apsfilter configuration file
  (<TT>/etc/gs.upp/y2prn_<B>printername</B>.upp</TT>) and YaST2 Printconf
  configuration file (<TT>/etc/gs.upp/y2prn_<B>printername</B>.y2</TT>).
  <LI>Call <TT>/var/lib/apsfilter/apsfilter.setup</TT> to add the printer
  (with <TT>/etc/gs.upp/y2prn_<B>printername</B>.upp</TT> as the configuration
  file).
  <LI>For USB printers, change the <TT>/etc/rc.config.d/usb.rc.config</TT> and
  <TT>/etc/rc.config</TT>.
  <LI>Change <TT>START_LPD</TT> to <TT>"yes"</TT> in <TT>/etc/rc.config</TT>.
  <LI>Call <TT>SuSEConfig</TT>.
  <!--LI>Check, whether required packages are installed and
    <TT>lpd</TT> is running. <I>If no, install and/or run it.</I>
  <LI>Create the spooling directory in <TT>/var/spool/lpd</TT> <I>(According to
    the user's settings.)</I>
  <LI>Copy the filter to the printer's spooling directory
  <LI>Copy printer's record from the printer database to the spooling directory.
    <I>For case, when the database changes and there is no record for this
      printer any more or when the printer was installed using "Have disk".</I> 
  <LI>Create the printer configuration file in its spooling directory. See
    <A HREF="spec_filter.html#config_file">filter configuration file</A> for
    further details.
    <I>This file is common for both the Configurator and the Filter Setup.</I>
  <LI>Write printer record to <TT>/etc/printcap</TT>. <I>Specifies the printer
    device and the filter. See <A HREF="spec_connection.html">Printer connection
    document</A>.</I>
  <LI>Invoke the <A HREF="spec_filter.html#filt_setup">Filter Setup</A>.
    <I>In it, the user can print the sample page.</I>
  <LI>If the filter setup fails, the printer should be deleted from the
    spooling system and an error should be returned to the Wizard.-->
</OL>

</BODY>
</HTML>
