<html><head><title>
YaST2 printconf internals
</title></head>
<body>
<h2>Printconf - The program</h2>
<h3>Loading</h3>
<p>
Reading the settings is done by agent <tt>.etc.printcap</tt>. Sources of
information:<ol>
<li>/etc/printcap - all queue names</li>
<li>/etc/lpdfilter/$QUEUE/yast2 - stored map <tt>printer</tt>.</li>
<li>/etc/lpdfilter/$QUEUE/conf - ascii printing settings</li>
</ol>
See the agent for details, it is simple and easy to understand.
</p>
<h3>Detection</h3>
<p>
For printer autodetection module <tt>Printer</tt> is used. See function
<tt>Detect</tt>. Proposal based on detected printer can be found in function
<tt>Propose</tt>. <font color="red">TODO/FIXME: Proposal needs improvments.
Now is only able to scan through all printers and make proposal for the new
ones. It should be able to make proposals "on demand", i.e. function
<tt>MakeProposal (unique_key)</tt> or <tt>MakeProposal (select (autodetected,
i, $[]))</tt></font>
</p>
<h3>Writting</h3>
<p>
When writting printers, deleted printers are wiped from disk at first, which
means that files <tt>/etc/lpdfilter/$QUEUE</tt> and
<tt>/var/spool/lpd/$QUEUE</tt> are recursively deleted.
</p>
<p>
Then for each printer following is made:<br>
Printcap entry is created. If printer was already present on disk and
re-creation isn't necessary, printcap part and upp file cached in
<tt>printer["saved"]</tt> will be saved. Otherwise new upp file is created and
<tt>lprsetup</tt> is used for printer creation. Note that if queue hadn't been
created by printconf, it is never re-created by <tt>lprsetup</tt>, it is
always re-created by saving stored settings. Editation of such queues is
disabled by printconf.<br>
If printer is created by yast2, map <tt>printer</tt> is saved into
<tt>/etc/lpdfilter/$QUEUE/yast2</tt>.<br>
Finally <tt>/etc/lpdfilter/$QUEUE/conf</tt> file is saved. If the printer is
Epson connected on USB, a wake-up sequence is written into
<tt>reset_before</tt>.
</p>
<p>
At the end <tt>/etc/printcap</tt> permissions are changed and status of unique
keys is updated (.probe.status.configured, unique_key --&gt; `yes or `no).<br>
Default destination is written into
<tt>.sysconfig.printer.DEFAULT_PRINTER</tt> and service <tt>lpd</tt> is
enabled.<br>
Please note that it is necessary to change permission of files although
lprsetup is doing it. We needn't call lprsetup in all cases. Some printers may
be written using <tt>printer["saved"]</tt>.
</p>
</body></html>
