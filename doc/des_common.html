<HTML>
<HEAD>
   <TITLE>Design of the YaST2 Printer Configurator</TITLE>
   <STYLE type="text/css">
   BODY { 
     color: black;
     background: white
   }
   </STYLE>
</HEAD>
<BODY>
<TABLE BORDER WIDTH="100%">
  <TR>
    <TD>Document</TD>
    <TD>Design of the YaST2 Printer Configurator</TD>
  </TR>
  <TR>
    <TD>Author</TD>
    <TD>Jan Holesovsky &lt;kendy@suse.cz&gt;</TD>
  </TR>
  <TR>
    <TD>Id</TD>
    <TD>$Id$</TD>
  </TR>
</TABLE>

<H2 align=center>Desired work progress</H2>

<P>I think, that the Printer Configurator should be implemented in this
order:</P>

<OL>
  <LI>Common functionality <I>(done)</I>
  <LI>Parallel printers <I>(done)</I>
  <LI>USB printers <I>(done)</I>
  <LI>Serial printers
  <LI>Remote printers
  <LI>Infrared printers
  <LI>Deleting end editing of the printers
  <LI>Samba (SMB) printers
  <LI>NetWare (NCP) printers
  <LI>Direct printers
  <LI>Printer Access protocol (PAP) printers
  <LI>Internet Printing Protocol (IPP) printers
</OL>

<H2 align=center>Programming language</H2>

<P>According to the documentation, the YCP seems to be strong enough to
implement the Configurator.</P>

<H2 align=center>Autodetection</H2>

<P>All autodetection is done by the <TT>libhd</TT> library. Details about the
autodetection can be additionally found in the <A
HREF="spec_connection.html">Possible printer connection document</A> and in
particular design documents.</P>

<P>Note: If the printer is already configured, the configurator shouldn't ask
user (again) whether to install it.

<H2 align=center>The Printer Database</H2>

<P><I>See Filter Requirements Document, section
<A HREF="spec_filter.html#database">The printer Database</A>.</I></P>

<P>The database is written as a ascii file. It is converted to the YCP using a
Perl script. The structure of the YCP form is:</P>

<OL type=i>
  <LI>The database is a list of manufacturer records.
  <LI>A manufacturer record is a map containing manufacturer's name (string),
    his id (string) and a product list (a list of printer records).
  <LI>A printer record is a map containing printer's name (string), its id
    (string) and a ps2printer record.
  <LI>A ps2printer record is a map containing a name of program that converts
    PostScript to the specific printer (string), rpm packages necessary for
    its function (a list of strings), program's necessary parameters
    (a list of strings) and its options (a list of option records).
  <LI>An option record is a map contaning a name of the option for user
    (string), its default value (string) and a map with possible values (where
    the key is the option and the value is its name).
</OL>

<P>Of course, variables should be used for common parts (usual paper sizes
and so).</P>

<P><B>An example of the database:</B>

<PRE>
// The YaST2 printer database
[                                      // A list of manufacturers
  $[                                   // One manufacturer
    "name" : "Hewlett-Packard",
    "1284id" : "HEWLETT-PACKARD",      // According to IEEE 1284
    "printers" : [                     // A list of products
      $[
        "name" : "HP LaserJet 5/5M",
        "1284id" : "HP_LAE238",        // According to IEEE 1284
	"ps2printer" : $[
	  "exec" : "gs",
	  "packages" : [ "gs_both", "gs_fonts", "gs_lib" ],
	  "params" : [ "-sDEVICE=ljet4" ],
	  "options" : [
	    $[
	      "name" : "Quality",
	      "default" : "-r=300x300",
	      "values" : $[
	        "-r=300x300" : "Letter quality",
		"-r=600x600" : "Letter quality 600x600 DPI"
	      ],
	    ], $[
	      "name" : "Paper size",
	      "default" : "-SIZE=a4",
	      "values" : $[
		"-SIZE=legal" : "Legal",
	        "-SIZE=a4" : "A4",
	        "-SIZE=a5" : "A5"
	      ]                        // end of values
	    ]
	  ]                            // end of options
	],                             // end of ps2printer
      ], $[
	// Another printer by HP
      ]
    ]
  ], $[
    // Epson or what...
  ]
]
</PRE>

<H2 align=center>Adding a printer to the spooling system</H2>

<P><I>See Printer (Auto)configurator, section
<A HREF="spec_printconf.html#add_printer">Adding a printer to the spooling system</A>.
</I></P>

<P>In the first step of updating of the spooling system:</P>

<UL>
  <LI><TT>lpd</TT> must be installed (if it is not).
  <LI><TT>apsfilter</TT> must be installed (if it is not).
  <LI><TT>lpd</TT> must be started (if it is not).
</UL>

<H2 align=center><A NAME="dialogs">Common dialog boxes</A></H2>

<P><I>See The Printer (Auto)configurator document, section
<A HREF="spec_printconf.html#wizard">The Configuration Wizard</A>
and Filter requirements document, section
<A HREF="spec_filter.html#filt_setup">The Filter Setup Tool</A>.</I></P>

<P>The Wizard dialogs:</P>
<OL>
  <LI>There is no interaction with the user at this point.
  <LI>There is no interaction with the user at this point.
  <LI>Dialog box: <TT>I have found printer &lt;printer&gt; by
    &lt;manufacturer&gt; on &lt;connection&gt;. Do you want to use it in your
    system?</TT> Buttons: <TT>Yes, Next, Back.</TT>
  <LI>Dialog box: <TT>I have found a printer on &lt;connection&gt;, but I
    can't decide its type. Do you want to use it in your system?</TT> Buttons:
    <TT>Yes, Next, Back.</TT>
  <LI><OL type=i>
    <LI>Dialog box with a listbox containing possible connections (parallel,
    USB, serial, ...): <TT>Please, choose the printer type you want to
    add:</TT> Buttons: <TT>Add, Finish</TT> <I>(instead of Next)</I><TT>,
    Back.</TT> <I>Help: Please, choose only printers you haven't already
    configured...</I>
    <LI>This dialog box depends on the type of connection and will
      be described in related design documents.
    <LI>Printer name dialog: The name is shown. When the "Change" button is
    pressed, an input line appears and the user can enter the new name.
    Buttons: <TT>Change, Next, Back.</TT>
    <LI>Filter setup dialog: Two listboxes---one for the names of the options
    with their current values and the second one with all possible values of
    the currently selected option. Buttons: <TT>Test, Next, Back</TT>.
  </OL>
  <LI>Dialog box with a list of configured printers: <TT>Summary:
    You have configured these printers:</TT> Button: <TT>OK</TT>
</OL>

<P>Make and model dialog: Two listboxes (one for a list of manufacturers and
one for his printers). <TT>Please, choose make and model
of your printer.</TT> Buttons: <TT>Next, Back.</TT></P>

</BODY>
</HTML>
