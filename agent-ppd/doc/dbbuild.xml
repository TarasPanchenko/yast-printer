<?xml version="1.0" encoding='ISO-8859-1'?>

    <section id="dbbuild">
        <title>Database file building</title>
	<section>
	    <title>Detection of need to rebuild</title>
	    <para>
The database must be rebuilt only if some PPD file is added/changed/remved. Otherwise, there is no need to recreate the prebuilt database file, and can be used as is.
For checking is used comparsion of last modification time of file with prebuilt database and of all PPD files.
	    </para>
	    <para>
Since database rebuild takes a lot of time and it would hurt before first use of the database, first check is different.
Package <computeroutput>yast2-printerdb</computeroutput> contains prebuilt database and list of all PPD files (both created during build process, required packages are in
needed-for-build list). When starting first time, if prebuilt database and list of PPD files are found, there is done comparsion of
number of PPD files (list vs. real) and installed packages (PPD files are contained in <computeroutput>cups</computeroutput>, <computeroutput>cups-drivers</computeroutput>
and <computeroutput>cups-drivers-stp</computeroutput>). If all of them are installed and the count of PPD files is the same, then there isn't done any detection
of last change dates, the database file is "touched" (for ensuring it will be the last) and database is used as is. Otherwise the database is completely rebuilt.
Additionally (doesn't matter whether prebuilt database can be used) list of PPD files in database will be removed to ensure it won't be used more.
	    </para>
	</section>
	<section>
	    <title>Building process</title>
	    <para>
Database building process consists from 3 steps:
	    </para>
	    <orderedlist>
		<listitem><para>Collect info about PPD files</para></listitem>
		<listitem><para>Merge additional data from SuSE database</para></listitem>
		<listitem><para>Flush data as YCP map to a file</para></listitem>
	    </orderedlist>
	    <section>
		<title>Collecting informations about PPD files</title>
		<para>
Each PPD file must be parsed and important entries from the PPD file must be fetched. Most important are entries describing manufacturer and model of the printer, and PPD file description.
Problem of PPD files is that there isn't possible to use only one entry to ge printer model, because different PPD files providers use different entries of PPD file to store this
information. Because of this problem there are hardcoded some rules inside (according to one entry devide what entry will be used to get real model name).
		</para>
		<para>
Additionally, there are problems with multiple different names of one printer manufacturer (eg. HP vs. Hewlett-Packard) and the same problem for printer models (usually added "series"
to the end of model name). Because of this there are lists of equivalences between both vendors and models.
		</para>
		<para>
Once required info is fetched from PPD file, the info about filename, vendor, model (both twice - for detection and display) is stored into internal structure, which is used in following steps.
		</para>
	    </section>
	    <section>
		<title>Data from SuSE database</title>
		<para>
Important information from SuSE database are stored in special file. It contains one line per printer, each line contains (except vendor and model) support status and comments.
This inforomation are added to internal structures. It is possible to add printer without any PPD file, in this case it is upon Printconf to switch to use SuSE database for
this printer.
		</para>
	    </section>
	    <section>
		<title>Flushing database to file</title>
		<para>
Flushing database to file is only simple walk through the map of settings and writing it to file in the YCP syntax.
		</para>
	    </section>
	</section>
	<section>
	    <title>Used structures</title>
	    <para>
TODO
	    </para>
	</section>
    </section>
